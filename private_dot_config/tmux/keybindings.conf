# Split windows with Alt+- (horizontal) and Alt+\ (vertical)
bind-key -n M-- split-window -c "#{pane_current_path}"
bind-key -n 'M-\' split-window -h -c "#{pane_current_path}"

# Close pane without confirmation (Alt+x)
bind-key -n M-x kill-pane

# New window (Alt+c)
bind-key -n M-c new-window -c "#{pane_current_path}"

# Cycle through windows (Alt+n / Alt+p)
bind-key -n M-n next-window
bind-key -n M-p previous-window

##### Display Popups #####

# Lazygit popup (Alt+z to open, Alt+z again to quit via lazygit keybinding)
bind-key -n M-z display-popup -d "#{pane_current_path}" -w 80% -h 80% -E "TMPDIR=$(getconf DARWIN_USER_TEMP_DIR) lazygit"

# Edit .zshrc in a popup (prefix + e)
bind e display-popup \
  -d "#{pane_current_path}" \
  -w 80% \
  -h 80% \
  -E "nvim ~/.zshrc"

# Yazi file manager (prefix + y)
bind y run-shell "tmux send-keys 'y' Enter"

# Vim mode
setw -g mode-keys vi

##### Vim-Tmux Navigator #####
# Smart pane switching with awareness of Vim splits
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R

# Prefix + hjkl for pane selection (fallback)
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Resize panes with Ctrl + Shift + H/J/K/L
bind-key -n C-H resize-pane -L 5
bind-key -n C-J resize-pane -D 5
bind-key -n C-K resize-pane -U 5
bind-key -n C-L resize-pane -R 5
